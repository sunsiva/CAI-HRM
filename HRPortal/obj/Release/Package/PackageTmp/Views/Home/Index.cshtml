@model HRPortal.Models.JobAndCandidateViewModels
@using HRPortal.Helper;

@{
    ViewBag.Title = "Home Page";
    bool isSuperAdmin = HelperFuntions.HasValue(CookieStore.GetCookie(CacheKey.RoleName.ToString())).ToUpper().Contains("ADMIN") ? true : false;
}

<div class="row">
    <div class="col-md-4">
        <br />
        @if (isSuperAdmin)
        {
            @Html.Partial("_SearchCriteria")
            @*@Html.DropDownListFor(m => m.ddlStatusId, new SelectList(Model.StatusList, "Value", "Text"), "-- Select a Status --", new { @class = "form-control", style = "width: 250px;", onchange = "this.form.submit();" })*@
            @Html.Partial("_CandidateList", Model.CandidateItems)
        }
        else {
            @Html.Partial("_SearchCriteria")
            @Html.Partial("_JobList", Model.JobItems)
        }
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
<script src="~/Scripts/moment.js"></script>
<script src="~/Scripts/bootstrap-datetimepicker.js"></script>
<script type="text/javascript" src="~/Scripts/bootstrap-multiselect.js"></script>
    <link rel="stylesheet" href="~/Content/bootstrap-multiselect.css" type="text/css" />
<script src="~/Scripts/jquery.cookie.js"></script>
<script lang="ja" type="text/javascript">
    $(document).ready(function () {
        $('.date-picker').datetimepicker({
            format: 'MM/DD/YYYY'
        });

        $('#ddlCriteriaVendor').multiselect(
            {
                includeSelectAllOption: true,
                enableCaseInsensitiveFiltering: true,
                nonSelectedText: '-- Select Partner --'
                //  onChange: function(option, checked, select) {
              //if (checked === true) {
              //  //action taken here if true
              //  alert('Checked' + checked + '.');
              //  alert('Changed option ' + $(option).val() + '.');
              //  } },
            });

       // alert($.cookie('CANSearchHome'));

        //Do it simple
        //var data = "People Alliance,Damco Soft";
        ////Make an array
        //var dataarray = data.split(",");
        //// Set the value
        //$("#ddlCriteriaVendor").val(dataarray);
        //// Then refresh
        //$("#ddlCriteriaVendor").multiselect("refresh");

        $('#ddlStatusSearchList').multiselect(
            {
                includeSelectAllOption: true,
                enableCaseInsensitiveFiltering: true,
                nonSelectedText: '-- Select Status --'
            });

        $('#ddlCriteriaPosition').multiselect(
            {
                includeSelectAllOption: true,
                enableCaseInsensitiveFiltering: true,
                nonSelectedText: '-- Select Position --'
            });

        $('#btnClearSearchC').click(function () {
            $("#txtCriteriaCanName").val('');
            $("#ddlCriteriaVendor").multiselect("clearSelection");
            $("#ddlCriteriaPosition").multiselect("clearSelection");
            $("#ddlStatusSearchList").multiselect("clearSelection");
            $("#txtCriteriaStDate").val(''); $("#txtCriteriaEndDate").val('');
            $.get("/Home/ClearSearch", { id: "CAN" },
                function (data) {
                    $("#CandidatesPartial").html(data);
                });
        });

        $('#btnClearSearchJ').click(function () {
            $("#txtPositionName").val('');
            $("#txtPublishedStDate").val(''); $("#txtPublishedEndDate").val('');
            $.get("/Home/ClearSearch", { id: "JOB" },
                function (data) {
                    $("#JobDetailsPartial").html(data);
                });
        });

        //var PosiIds = "";
        //$("#ddlCriteriaPosition").each(function () {
        //    if ($(this).is(":checked")) {
        //        var userid = $(this).attr("value");
        //        PosiIds = PosiIds + userid + ',';
        //    }
        //});
        //$("#PositionIds").val(PosiIds);

        window.myPanel = function (data) {
            $(".candidate-name").text(data.dataset.customName);
            $("#hdnCandidateId").val(data.dataset.customValue);
            var currentSts = $("#btnStsPnl_" + data.dataset.customValue + "").text();
            $("#ddlStatusList option:contains(" + currentSts + ")").attr("selected", true);
            $("#txtStsComments").val("");
            $("#btnStatus").removeAttr("data-dismiss", "modal");
        };

        window.fnBtnStatusClick = function () {
            if ($("#ddlStatusList").val() == "") {
                $("#errMsgModal").text("Please select a status to change.");
                $("#ddlStatusList").focus();
                return false;
            }
            else if ($("#txtStsComments").val() == "") {
                $("#errMsgModal").text("Please write a comments to change.");
                $("#txtStsComments").focus();
                return false;
            }
            else {
                $.get("/Home/StatusUpdate", { id: $("#hdnCandidateId").val(), status: $("#ddlStatusList").val(), comments: $("#txtStsComments").val() },
                    function (data) {
                        $("#btnStsPnl_" + $("#hdnCandidateId").val() + "").text($("#ddlStatusList option:selected").text());
                    });
                $("#btnStatus").attr("data-dismiss", "modal");
            }
        };

        $('#CollapseMe').click(function () {
            $(this).hasClass('glyphicon-triangle-bottom') ? $(this).removeClass('glyphicon-triangle-bottom') && $(this).addClass('glyphicon-triangle-top') : $(this).removeClass('glyphicon-triangle-top') && $(this).addClass('glyphicon-triangle-bottom');
        });

        $("#btnSearchCriteria").click(function () {
            var vendor = $("#ddlCriteriaVendor").val() == null ? "" : $("#ddlCriteriaVendor").val().join(','), position = $("#ddlCriteriaPosition").val() == null ? "" : $("#ddlCriteriaPosition").val().join(',')
            , status = $("#ddlStatusSearchList").val() == null ? "" : $("#ddlStatusSearchList").val().join(',');
            $.get("/Home/SearchCriteria", { name: $("#txtCriteriaCanName").val(), vendor: vendor, position: position, status: status, stdt: $("#txtCriteriaStDate").val(), edt: $("#txtCriteriaEndDate").val() }, function (data) {
                $("#CandidatesPartial").html(data);
            });
        });

        $("#btnSearchCriteriaJob").click(function () {  
            $.get("/Home/SearchCriteria", { name: $("#txtPositionName").val(), vendor: "", status: "", stdt: $("#txtPublishedStDate").val(), edt: $("#txtPublishedEndDate").val() }, function (data) {
                $("#JobDetailsPartial").html(data);
            });
        });
    });
</script>
}