@using PagedList;
@using PagedList.Mvc;
@model IPagedList<HRPortal.Models.CandidateViewModels>

@{
    ViewBag.Title = "SquadJobs";
    Layout = "~/Views/Shared/_Layout.cshtml";
    int sl = 0;
}

<h2>Profile submissions by squad</h2>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="table-responsive">
                <table class="table table-striped table-hover table-condensed table-bordered">
                    <tr>
                        <th>#</th>
                        <th>
                            @Html.ActionLink("CANDIDATE NAME", "SquadJobs", new { sOdr = ViewBag.CNameSort })
                        </th>
                        <th>
                            YEARS OF EXP.
                        </th>
                        <th>
                            @Html.DisplayName("MOBILE NO")
                        </th>
                        <th>
                            @Html.ActionLink("EMAIL", "SquadJobs", new { sOdr = ViewBag.EmailSort })
                        </th>
                        <th>
                            @Html.DisplayName("CURRENT COMPANY")
                        </th>
                        <th>
                            @Html.DisplayName("NOTICE PERIOD/LWD")
                        </th>
                        <th>@Html.DisplayName("SUBMITTED BY")</th>
                        <th>
                            @Html.ActionLink("STATUS", "SquadJobs", new { sOdr = ViewBag.StatusSort })
                        </th>
                        <th colspan="3">@Html.DisplayName("ACTION")</th>
                    </tr>

                    @foreach (var item in Model)
    {
                <tr>
                    <td>@(sl = sl + 1) </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CANDIDATE_NAME)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.YEARS_OF_EXP_TOTAL)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.MOBILE_NO)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.EMAIL)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CURRENT_COMPANY)
                    </td>
                    <td>
                        @(item.LAST_WORKING_DATE != null ? (item.LAST_WORKING_DATE.Value.ToString("dd-MMM-yyyy")) : item.NOTICE_PERIOD)
                    </td>
                    <td>@Html.DisplayFor(modelItem => item.CREATED_BY)</td>
                    <td>
                        @if (item.STATUS.ToUpper().ToString().Contains("TOBESCHEDULED"))
                {<a href="#StatusModal" id="btnStsPnl_@item.CANDIDATE_ID" data-toggle="modal" onclick='myPanel(this); return false;' data-custom-name="@item.CANDIDATE_NAME" data-custom-value="@item.CANDIDATE_ID" data-custom-statusid="@item.STATUS_ID" title="Click To Change The Status">@item.STATUS</a>
                        <span id="stsSecondTxt_@item.CANDIDATE_ID"></span>
                }
                else { @Html.DisplayFor(modelItem => item.STATUS) }
                    </td>
                    <td>
                        <p data-placement="top" data-toggle="tooltip" title="Details">
                            <a href="@Url.Action("Details", "Candidate", new { id = item.CANDIDATE_ID,styp="S"  })" class="btn btn-info btn-xs" id="btnJobDetails" value="@item.CANDIDATE_ID">
                                <span class="glyphicon glyphicon-list"></span>
                            </a>
                        </p>
                    </td>
                    <td>
                        <p data-placement="top" data-toggle="tooltip" title="Edit">
                            <a href="@Url.Action("Edit", "Candidate", new { id = item.CANDIDATE_ID,styp="S"  })" id="btnJobEdit" value="@item.CANDIDATE_ID" class="btn btn-primary btn-xs">
                                <span class="glyphicon glyphicon-pencil"></span>
                            </a>
                        </p>
                    </td>

                    @*<td>
                    <p data-placement="top" data-toggle="tooltip" title="Active/Inactive">
                        <a href="@Url.Action("Delete", "Candidate", new { id = item.CANDIDATE_ID })" class="btn btn-danger btn-xs" id="btnJobDelete" value="@item.CANDIDATE_ID">
                            <span class="glyphicon glyphicon-remove"></span>
                        </a>
                    </p>
                </td>*@
                </tr>
    }
                    <tr><td><input type="hidden" id="hdnCandidateId" /><input type="hidden" id="hdnStatusId" /></td><td align="right" class="" colspan="11">@Model.Count() Record(s) found.</td></tr>
                </table>
                <div class="clearfix"></div>
                <table align="right">
                    <tr>
                        <td>Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount  </td>
                        <td width="10px"></td>
                        <td>
                            @Html.PagedListPager(Model, page => Url.Action("SquadJobs", "Candidate", new { page, sOdr = ViewBag.CurrentSort }))
                        </td>
                    </tr>
                </table>
          </div>
        </div>
    </div>
</div>

<div class="modal fade" id="StatusModal" tabindex="-1" role="dialog" aria-labelledby="StatusModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Schedule Interview for - <b><span class="candidate-name"></span></b> </h4>
            </div>
            <div class="modal-body">
                <div class="form-group form-group-required">
                    @Html.Label("Date", new { @class = "col-md-2 control-label" })
                    <div class='col-sm-6'>
                        <input type='text' class="form-control" id='datetimepicker' />
                    </div>
                </div>
                <br /><br />
                <div class="form-group form-group-required">
                    @Html.Label("Comments", new { @class = "col-md-2 control-label" })
                    <div class="col-md-10">
                        @Html.TextArea("Comments", new { @id = "txtStsComments", @class = "textarea-input-custom", @required = "mandatory" })
                    </div>
                </div>
                <span class="text-danger" id="errMsgModal"><small>If you don't save, your changes will be lost.</small></span>
            </div>
            <div class="modal-footer">
                <div class="pull-right">
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove"></i> Close</button>
                    <button type="button" id="btnStatus" class="btn btn-success" data-dismiss="modal"><i class="glyphicon glyphicon-ok"></i> Save</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Scripts/moment.js"></script>
    <script src="~/Scripts/bootstrap-datetimepicker.js"></script>

    <script lang="ja" type="text/javascript">
        $(document).ready(function () {

            $(function () {
                $('#datetimepicker').datetimepicker();
            });

            window.myPanel = function (data) {
                $(".candidate-name").text(data.dataset.customName);
                $("#hdnCandidateId").val(data.dataset.customValue);
                $("#hdnStatusId").val(data.dataset.customStatusid);
                $("#txtStsComments").val('');
            };

            $("#btnStatus").click(function () {
                if ($("#txtSchDate").val() == "") {
                    $("#errMsgModal").text("Please schedule a candidate.");
                    $("#txtSchDate").focus();
                    return false;
                }
                else if ($("#txtStsComments").val() == "") {
                    $("#errMsgModal").text("Please write a comments to change.");
                    $("#txtStsComments").focus();
                    return false;
                }
                else {
                    $.get("/Candidate/ScheduleCandidate", { id: $("#hdnCandidateId").val(), date: $("#datetimepicker").val(), comments: $("#txtStsComments").val(), statusId: $("#hdnStatusId").val() },
                        function (data) {
                            var id = $("#hdnCandidateId").val();
                            $("#stsSecondTxt_" + id).text(data);
                            $("#btnStsPnl_" + id).addClass("hide");
                        });
                }
            });

        });
    </script>
}
